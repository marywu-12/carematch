{% include calculate_relative_base.html %}
{% include escape-404.html %}

<header class="main-header">
  <div class="wrapper">
    <div class="header-flex">
      <div class="menu-icon-container">
        <span class="menu-icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
      </div>
      <nav class="main-nav">
        <span class="menu-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>

        <ul>
          <!-- Home -->
          <li>
            <a href="{{ relativebase }}">
              <div class="left">Home</div>
              <div class="right"><i class="fa fa-home"></i></div>
            </a>
          </li>
        
          <!-- About (parent does NOT navigate) -->
          <li class="has-submenu">
            <a href="javascript:void(0)">
              <div class="left">About</div>
              <div class="right"><i class="fa fa-info-circle"></i></div>
            </a>
            <ul class="submenu">
              <li><a href="{{ relativebase }}mission.html">Mission</a></li>
              <li><a href="{{ relativebase }}strategy.html">Strategy</a></li>
              <li><a href="{{ relativebase }}faq.html">FAQ</a></li>
              <li><a href="{{ relativebase }}team.html">Team</a></li>
            </ul>
          </li>
        
          <!-- Resources (parent does NOT navigate) -->
          <li class="has-submenu">
            <a href="javascript:void(0)">
              <div class="left">Resources</div>
              <div class="right"><i class="fa fa-book"></i></div>
            </a>
            <ul class="submenu">
              <li><a href="{{ relativebase }}updates.html">Updates</a></li>
              <li><a href="{{ relativebase }}archive.html">Blog</a></li>
              <li><a href="{{ relativebase }}partners.html">Partners</a></li>
              <li><a href="{{ relativebase }}survey.html">Survey</a></li>
            </ul>
          </li>
        
          <!-- Get Involved -->
          <li>
            <a href="{{ relativebase }}get-involved.html">
              <div class="left">Get Involved</div>
              <div class="right"><i class="fa fa-users"></i></div>
            </a>
          </li>
        </ul>




      </nav>

      {% capture logo_url %}{{ relativebase }}{{ site.logo  }}{% endcapture %}
      {% assign logo_url = logo_url | replace: "//", "/" %}
      <div class="logo">
        <a class="navbar-brand site-title" href="{{ relativebase }}">
          {% if site.logo and site.logo != "" %}
            <img class="logo" id="logo" src="{{ logo_url }}" alt="{{ site.title }}">
          {% else %}
            {{ site.title }}
          {% endif %}
        </a>
      </div>
      <div class="search-icon-container">
        <span class="search-icon"><a><i class="fa fa-search" aria-hidden="true"></i></a></span>
      </div>
    </div>
  </div>
</header>

<script>
(function () {
  // Intercept parent-link clicks BEFORE any other listeners (capture phase)
  document.addEventListener('click', function (evt) {
    const link = evt.target.closest('.main-header .main-nav .has-submenu > a');
    if (!link) return;

    evt.preventDefault();             // never navigate (href is javascript:void(0) anyway)
    evt.stopPropagation();            // don't bubble to any "close sidebar" handlers
    evt.stopImmediatePropagation();   // cancel other click listeners on this target

    const li = link.parentElement;
    li.classList.toggle('open');
    link.setAttribute('role', 'button');
    link.setAttribute('aria-expanded', li.classList.contains('open'));
    link.blur();
  }, true); //  <-- capture = true, runs before other handlers

  // Submenu items should navigate normally, but don't bubble upward
  document.querySelectorAll('.main-header .main-nav .has-submenu .submenu a')
    .forEach(a => a.addEventListener('click', e => e.stopPropagation()));

  // Keyboard accessibility for the parent toggles
  document.querySelectorAll('.main-header .main-nav .has-submenu > a')
    .forEach(a => a.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); a.click(); }
    }));
})();
</script>
